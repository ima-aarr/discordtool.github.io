<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discord Ultimate Toolkit</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Noto+Sans+JP:wght@400;700&display=swap');

        :root {
            --aurora-1: #4e54c8;
            --aurora-2: #8f94fb;
            --aurora-3: #ad5389;
            --aurora-4: #3d3393;
        }

        body {
            font-family: 'Inter', 'Noto Sans JP', sans-serif;
            background: linear-gradient(-45deg, var(--aurora-1), var(--aurora-2), var(--aurora-3), var(--aurora-4));
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
            color: #ffffff;
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }

        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
        }

        .input-pro {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #fff;
            padding: 10px 14px;
            border-radius: 6px;
            width: 100%;
            transition: all 0.2s;
            font-size: 14px;
        }

        .input-pro:focus {
            border-color: var(--aurora-2);
            outline: none;
            background: rgba(0, 0, 0, 0.4);
        }

        .nav-link {
            padding: 12px 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: 0.2s;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 12px;
            color: rgba(255, 255, 255, 0.7);
        }

        .nav-link:hover { background: rgba(255, 255, 255, 0.1); color: white; }
        .nav-link.active { background: rgba(255, 255, 255, 0.15); color: white; font-weight: 700; border-left: 4px solid #fff; }

        .custom-scroll::-webkit-scrollbar { width: 5px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.2); border-radius: 10px; }

        .btn-send {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: transform 0.1s, filter 0.2s;
        }
        .btn-send:hover { filter: brightness(1.2); }
        .btn-send:active { transform: scale(0.98); }
    </style>
</head>
<body class="flex">

    <nav class="w-72 h-screen p-6 flex flex-col glass m-2">
        <div class="mb-10 px-2">
            <h1 class="text-xl font-bold tracking-tighter flex items-center gap-3">
                <i class="fab fa-discord"></i> TOOLKIT ULTIMATE
            </h1>
            <p class="text-[10px] opacity-50 mt-1 font-mono uppercase">Professional Edition v3.0</p>
        </div>

        <div class="flex-grow space-y-2">
            <div onclick="App.route('embed')" id="nav-embed" class="nav-link active"><i class="fas fa-edit"></i> Embed ビルダー</div>
            <div onclick="App.route('canvas')" id="nav-canvas" class="nav-link"><i class="fas fa-magic"></i> 画像生成</div>
            <div onclick="App.route('perms')" id="nav-perms" class="nav-link"><i class="fas fa-key"></i> 権限計算</div>
            <div onclick="App.route('utils')" id="nav-utils" class="nav-link"><i class="fas fa-layer-group"></i> ユーティリティ</div>
        </div>

        <div class="pt-6 border-t border-white/10">
            <button onclick="App.clearStorage()" class="text-xs opacity-50 hover:opacity-100 transition"><i class="fas fa-sync mr-2"></i>設定をリセット</button>
        </div>
    </nav>

    <main class="flex-grow h-screen p-2 overflow-hidden relative">
        <div class="h-full glass custom-scroll overflow-y-auto p-8">
            
            <section id="view-embed" class="view-content space-y-8">
                <div class="grid grid-cols-1 xl:grid-cols-[1fr_450px] gap-8">
                    <div class="space-y-6">
                        <header>
                            <h2 class="text-2xl font-bold">Embed Builder</h2>
                            <p class="text-sm opacity-60">Webhookを使用して高度なメッセージを送信します</p>
                        </header>

                        <div class="space-y-4">
                            <input type="password" id="wb-url" placeholder="Webhook URL" class="input-pro">
                            <div class="grid grid-cols-2 gap-4">
                                <input type="text" id="wb-name" placeholder="Bot名 (任意)" class="input-pro">
                                <input type="text" id="wb-avatar" placeholder="アイコンURL (任意)" class="input-pro">
                            </div>
                        </div>

                        <div class="space-y-4 pt-4 border-t border-white/10">
                            <div class="flex gap-4">
                                <input type="text" id="em-title" placeholder="タイトル" class="input-pro font-bold">
                                <input type="color" id="em-color" value="#5865f2" class="w-16 h-10 bg-transparent border-none cursor-pointer">
                            </div>
                            <textarea id="em-desc" placeholder="説明文 (Markdown利用可能)" class="input-pro h-48 resize-none"></textarea>
                            <div class="grid grid-cols-2 gap-4">
                                <input type="text" id="em-img" placeholder="メイン画像URL" class="input-pro">
                                <input type="text" id="em-thumb" placeholder="サムネイルURL" class="input-pro">
                            </div>
                        </div>

                        <button onclick="Embed.send()" class="btn-send w-full py-4 rounded-xl font-bold text-lg shadow-2xl">
                            Discordへ送信
                        </button>
                    </div>

                    <div class="relative">
                        <div class="sticky top-0 space-y-4">
                            <label class="text-xs font-bold uppercase tracking-widest opacity-50">Preview</label>
                            <div class="bg-[#313338] p-4 rounded-lg shadow-2xl flex gap-4 pointer-events-none text-left">
                                <img id="pv-avatar" src="https://cdn.discordapp.com/embed/avatars/0.png" class="w-10 h-10 rounded-full shrink-0">
                                <div class="flex-grow min-w-0">
                                    <div class="flex items-center gap-2 mb-1">
                                        <span id="pv-name" class="font-medium text-white truncate text-sm">Bot</span>
                                        <span class="bg-[#5865f2] text-[10px] px-1 rounded text-white font-bold">BOT</span>
                                        <span class="text-[11px] text-[#949ba4]">Today at 12:00 PM</span>
                                    </div>
                                    <div id="pv-border" class="bg-[#2b2d31] border-l-4 rounded p-3 max-w-[432px]" style="border-color: #5865f2;">
                                        <div id="pv-title" class="text-sm font-bold text-[#00a8fc] mb-1 hidden"></div>
                                        <div id="pv-desc" class="text-[13px] text-[#dbdee1] whitespace-pre-wrap leading-snug"></div>
                                        <img id="pv-img" class="mt-3 rounded max-w-full hidden border border-white/5">
                                    </div>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-2">
                                <button onclick="Embed.exportJSON()" class="glass p-2 text-xs rounded hover:bg-white/10">JSONをコピー</button>
                                <button onclick="Embed.importJSON()" class="glass p-2 text-xs rounded hover:bg-white/10">JSONを読込</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="view-canvas" class="view-content hidden space-y-8 text-center">
                <header class="text-left">
                    <h2 class="text-2xl font-bold">Asset Generator</h2>
                    <p class="text-sm opacity-60">ウェルカム画像やバナーを数秒で生成します</p>
                </header>
                <div class="inline-block p-4 glass shadow-2xl">
                    <canvas id="main-cv" width="800" height="400" class="max-w-full rounded-lg"></canvas>
                </div>
                <div class="max-w-2xl mx-auto grid grid-cols-2 gap-4">
                    <input type="text" id="cv-text" value="WELCOME" class="input-pro" placeholder="メインテキスト">
                    <input type="color" id="cv-t-color" value="#ffffff" class="w-full h-10 bg-transparent border-none">
                    <button onclick="Canvas.export()" class="btn-send col-span-2 py-3 rounded-lg font-bold">画像をダウンロード (PNG)</button>
                </div>
            </section>

            <section id="view-perms" class="view-content hidden">
                <div class="max-w-4xl mx-auto space-y-6">
                    <div class="glass p-8 flex justify-between items-center">
                        <div>
                            <span class="text-xs opacity-50 font-bold uppercase">計算された整数値</span>
                            <div id="perm-res" class="text-5xl font-mono font-bold tracking-tighter text-white">0</div>
                        </div>
                        <input type="text" id="perm-dec" placeholder="値をデコード" class="input-pro w-48 font-mono text-center" oninput="Perms.decode()">
                    </div>
                    <div id="perm-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3"></div>
                </div>
            </section>

            <section id="view-utils" class="view-content hidden">
                <div class="max-w-2xl mx-auto space-y-8">
                    <div class="glass p-6 space-y-4">
                        <h3 class="font-bold border-b border-white/10 pb-2">Discord タイムスタンプ</h3>
                        <input type="datetime-local" id="ts-in" class="input-pro">
                        <select id="ts-type" class="input-pro">
                            <option value="R">相対時間 (5分前)</option>
                            <option value="F">日付と時刻 (2026年1月4日 20:00)</option>
                            <option value="d">短い日付 (2026/01/04)</option>
                        </select>
                        <div onclick="Utils.copyTS()" id="ts-res" class="bg-black/30 p-4 rounded-lg font-mono text-[#00a8fc] text-center cursor-pointer hover:bg-black/50 transition">クリックしてコピー</div>
                    </div>
                </div>
            </section>

        </div>
    </main>

    <script>
        const App = {
            route(id) {
                document.querySelectorAll('.view-content').forEach(v => v.classList.add('hidden'));
                document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));
                document.getElementById(`view-${id}`).classList.remove('hidden');
                document.getElementById(`nav-${id}`).classList.add('active');
            },
            init() {
                Embed.init();
                Perms.init();
                Canvas.init();
                this.load();
                setInterval(() => this.save(), 2000);
            },
            save() {
                const data = {};
                document.querySelectorAll('input, textarea, select').forEach(el => {
                    if (el.id && el.type !== 'file' && el.type !== 'password') data[el.id] = el.value;
                });
                localStorage.setItem('discord_ultimate_state', JSON.stringify(data));
            },
            load() {
                const saved = localStorage.getItem('discord_ultimate_state');
                if (!saved) return;
                const data = JSON.parse(saved);
                Object.keys(data).forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.value = data[id];
                });
                Embed.update();
                Canvas.draw();
            },
            clearStorage() {
                if(confirm('設定をリセットしますか？')) {
                    localStorage.removeItem('discord_ultimate_state');
                    location.reload();
                }
            }
        };

        const Embed = {
            init() {
                ['wb-name', 'wb-avatar', 'em-title', 'em-desc', 'em-color', 'em-img'].forEach(id => {
                    document.getElementById(id).addEventListener('input', () => this.update());
                });
            },
            update() {
                const get = (id) => document.getElementById(id).value;
                document.getElementById('pv-name').innerText = get('wb-name') || 'Bot';
                document.getElementById('pv-avatar').src = get('wb-avatar') || 'https://cdn.discordapp.com/embed/avatars/0.png';
                
                const titleEl = document.getElementById('pv-title');
                if(get('em-title')) {
                    titleEl.innerText = get('em-title');
                    titleEl.classList.remove('hidden');
                } else titleEl.classList.add('hidden');

                document.getElementById('pv-desc').innerText = get('em-desc');
                document.getElementById('pv-border').style.borderColor = get('em-color');

                const imgEl = document.getElementById('pv-img');
                if(get('em-img')) {
                    imgEl.src = get('em-img');
                    imgEl.classList.remove('hidden');
                } else imgEl.classList.add('hidden');
            },
            async send() {
                const url = document.getElementById('wb-url').value;
                if(!url) return alert('Webhook URLを入力してください');
                
                const payload = {
                    username: document.getElementById('wb-name').value || undefined,
                    avatar_url: document.getElementById('wb-avatar').value || undefined,
                    embeds: [{
                        title: document.getElementById('em-title').value || undefined,
                        description: document.getElementById('em-desc').value || undefined,
                        color: parseInt(document.getElementById('em-color').value.replace('#',''), 16),
                        image: document.getElementById('em-img').value ? { url: document.getElementById('em-img').value } : undefined
                    }]
                };

                try {
                    const res = await fetch(url, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(payload) });
                    alert(res.ok ? '送信成功' : '送信失敗: ' + res.status);
                } catch(e) { alert(e); }
            },
            exportJSON() {
                const payload = { embeds: [{ title: document.getElementById('em-title').value, description: document.getElementById('em-desc').value }] };
                navigator.clipboard.writeText(JSON.stringify(payload, null, 2));
                alert('JSONをコピーしました');
            }
        };

        const Canvas = {
            ctx: null,
            init() {
                this.ctx = document.getElementById('main-cv').getContext('2d');
                document.getElementById('cv-text').addEventListener('input', () => this.draw());
                document.getElementById('cv-t-color').addEventListener('input', () => this.draw());
                this.draw();
            },
            draw() {
                const ctx = this.ctx;
                const grd = ctx.createLinearGradient(0, 0, 800, 400);
                grd.addColorStop(0, "#4e54c8");
                grd.addColorStop(1, "#ad5389");
                ctx.fillStyle = grd;
                ctx.fillRect(0, 0, 800, 400);
                
                ctx.fillStyle = "rgba(0,0,0,0.3)";
                ctx.fillRect(40, 40, 720, 320);

                ctx.fillStyle = document.getElementById('cv-t-color').value;
                ctx.font = "bold 80px Inter";
                ctx.textAlign = "center";
                ctx.shadowBlur = 20;
                ctx.shadowColor = "rgba(0,0,0,0.5)";
                ctx.fillText(document.getElementById('cv-text').value, 400, 220);
            },
            export() {
                const link = document.createElement('a');
                link.download = 'discord_asset.png';
                link.href = document.getElementById('main-cv').toDataURL();
                link.click();
            }
        };

        const Perms = {
            list: [
                {n:"Administrator", v:0x8n}, {n:"Manage Guild", v:0x20n}, {n:"Manage Roles", v:0x10000000n},
                {n:"Manage Channels", v:0x10n}, {n:"Kick Members", v:0x2n}, {n:"Ban Members", v:0x4n},
                {n:"Manage Messages", v:0x2000n}, {n:"View Channels", v:0x400n}, {n:"Send Messages", v:0x800n}
            ],
            init() {
                const grid = document.getElementById('perm-grid');
                this.list.forEach(p => {
                    const label = document.createElement('label');
                    label.className = "glass p-4 flex items-center gap-3 cursor-pointer hover:bg-white/10 transition";
                    label.innerHTML = `<input type="checkbox" value="${p.v}" class="p-cb w-5 h-5 accent-purple-500"> <span class="text-sm">${p.n}</span>`;
                    label.querySelector('input').addEventListener('change', () => this.calc());
                    grid.appendChild(label);
                });
            },
            calc() {
                let total = 0n;
                document.querySelectorAll('.p-cb:checked').forEach(c => total += BigInt(c.value));
                document.getElementById('perm-res').innerText = total.toString();
            },
            decode() {
                const val = BigInt(document.getElementById('perm-dec').value || 0);
                document.querySelectorAll('.p-cb').forEach(c => c.checked = (val & BigInt(c.value)) === BigInt(c.value));
                this.calc();
            }
        };

        const Utils = {
            copyTS() {
                const date = document.getElementById('ts-in').value;
                if(!date) return;
                const unix = Math.floor(new Date(date).getTime() / 1000);
                const type = document.getElementById('ts-type').value;
                const code = `<t:${unix}:${type}>`;
                navigator.clipboard.writeText(code);
                document.getElementById('ts-res').innerText = code;
            }
        };

        window.onload = () => App.init();
    </script>
</body>
</html>
